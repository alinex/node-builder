<!DOCTYPE html>
<html>
<head>
  <title>cli.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../", thisFile = "home/alex/a3/node-builder/src/clicoffee", defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>
  <script src="../fileSearch.js"></script>
  <script src="../goToLine.js"></script>
  <link rel="stylesheet" href="../fileSearch.css" />
  <link rel="stylesheet" href="../goToLine.css" />
</head>
<body>
  <nav>
<div class="logo"><a href="http://alinex.github.io" onmouseover="lllogo.src='https://alinex.github.io/images/Alinex-200.png'" onmouseout="lllogo.src='https://alinex.github.io/images/Alinex-black-200.png'">
  <img name="lllogo" src="https://alinex.github.io/images/Alinex-black-200.png" width="150" title="Alinex Universe Homepage" />
  </a>
  <img src="http://alinex.github.io/images/Alinex-200.png" style="display:none" alt="preloading" />
</div>
<div class="links">
  <a href="http://alinex.github.io/blog" class="btn btn-primary"><span class="glyphicon-cog"></span> Blog</a>
  <a href="http://alinex.github.io/code.html" class="btn btn-warning"><span class="glyphicon-pencil"></span> Code</a>
</div>
</nav><div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#startup%20script">Startup script</a>
      </div>
      <div class="heading h3">
        <a href="#main%20routine">Main routine</a>
      </div>
      <div class="heading h3">
        <a href="#task%20libraries">Task libraries</a>
      </div>
      <div class="heading h2">
        <a href="#node%20modules">Node Modules</a>
      </div>
      <div class="heading h2">
        <a href="#setup%20build%20environment">Setup build environment</a>
      </div>
      <div class="heading h2">
        <a href="#start%20argument%20parsing">Start argument parsing</a>
      </div>
      <div class="heading h2">
        <a href="#init%20config">Init config</a>
      </div>
      <div class="heading h2">
        <a href="#run%20the%20commands">Run the commands</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container" tabindex="0"><a id="fork" href="https://github.com/alinex/node-builder" title="Fork me on GitHub"></a><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
<div class="pilwrap" id="startup%20script">
  <h1>
    <a href="#startup%20script" name="startup%20script" class="pilcrow">&#182;</a>
    Startup script
  </h1>
</div>


<p>This file is used to manage the whole build environment.</p>


<div class="pilwrap" id="main%20routine">
  <h3>
    <a href="#main%20routine" name="main%20routine" class="pilcrow">&#182;</a>
    Main routine
  </h3>
</div>


<p>This file defines the command line interface with the defined commands. They
will be run in parallel as possible.</p>

<p>It will work with an boolean <code>success</code> value which is handed through the
functions to define if everything went correct or something was not possible.
If an real and unexpected error occur it will be thrown. All errors which
aren't caught will end in an error and abort with exit code 2.</p>


<div class="pilwrap" id="task%20libraries">
  <h3>
    <a href="#task%20libraries" name="task%20libraries" class="pilcrow">&#182;</a>
    Task libraries
  </h3>
</div>


<p>Each task is made available as separate task module with the <code>run</code> method
to be called for each alinex package. The given command on the command line
call may trigger multiple tasks which are done.</p>

<p>Each task will get a <code>command</code> object which holds all the information from the
command line call.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="node%20modules">
  <h2>
    <a href="#node%20modules" name="node%20modules" class="pilcrow">&#182;</a>
    Node Modules
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<p>include base modules</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nv">fs = </span><span class="nx">require</span> <span class="s">&#39;fs&#39;</span>
<span class="nv">yargs = </span><span class="nx">require</span> <span class="s">&#39;yargs&#39;</span>
<span class="nv">path = </span><span class="nx">require</span> <span class="s">&#39;path&#39;</span>
<span class="nv">chalk = </span><span class="nx">require</span> <span class="s">&#39;chalk&#39;</span>
<span class="nv">async = </span><span class="nx">require</span> <span class="s">&#39;async&#39;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<p>include alinex modules</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nv">Spawn = </span><span class="nx">require</span> <span class="s">&#39;alinex-spawn&#39;</span>
<span class="nv">errorHandler = </span><span class="nx">require</span> <span class="s">&#39;alinex-error&#39;</span>
<span class="nx">errorHandler</span><span class="p">.</span><span class="nx">install</span><span class="p">()</span>
<span class="nv">errorHandler.config.stack.modules = </span><span class="kc">true</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="setup%20build%20environment">
  <h2>
    <a href="#setup%20build%20environment" name="setup%20build%20environment" class="pilcrow">&#182;</a>
    Setup build environment
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>Root directory of the core application</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nv">GLOBAL.ROOT_DIR = </span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span> <span class="nx">__dirname</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>Read in package configuration</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nv">GLOBAL.PKG = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span> <span class="nx">ROOT_DIR</span><span class="p">,</span> <span class="s">&#39;package.json&#39;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>setup search path for configs</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="k">for</span> <span class="nx">path</span> <span class="k">in</span>  <span class="p">[</span>
    <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">),</span> <span class="s">&#39;var/src/config&#39;</span>
    <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">),</span> <span class="s">&#39;var/local/config&#39;</span>
  <span class="p">]</span>
  <span class="nx">Spawn</span><span class="p">.</span><span class="nx">configsearch</span><span class="p">.</span><span class="nx">push</span> <span class="nx">path</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>list of possible commands</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nv">commands =</span>
  <span class="nv">list: </span><span class="s">&quot;show the list of possible commands&quot;</span>
  <span class="nv">create: </span><span class="s">&quot;create a new package&quot;</span>
  <span class="nv">update: </span><span class="s">&quot;update and installation of package with dependent packages&quot;</span>
  <span class="nv">compile: </span><span class="s">&quot;compile code&quot;</span>
  <span class="nv">pull: </span><span class="s">&quot;pull newest version from repository&quot;</span>
  <span class="nv">push: </span><span class="s">&quot;push changes to repository&quot;</span>
  <span class="nv">publish: </span><span class="s">&quot;publish package in npm&quot;</span>
  <span class="nv">doc: </span><span class="s">&quot;create documentation pages&quot;</span>
  <span class="nv">test: </span><span class="s">&quot;run automatic tests&quot;</span>
  <span class="nv">clean: </span><span class="s">&quot;cleanup files&quot;</span>
  <span class="nv">changes: </span><span class="s">&quot;list unpublished changes&quot;</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="start%20argument%20parsing">
  <h2>
    <a href="#start%20argument%20parsing" name="start%20argument%20parsing" class="pilcrow">&#182;</a>
    Start argument parsing
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nv">argv = </span><span class="nx">yargs</span>
<span class="p">.</span><span class="nx">usage</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">  Utility to help simplify tasks in development.</span>

<span class="s">  Usage: $0 [-vC] -c command... [dir]...</span>
<span class="s">  &quot;&quot;&quot;</span><span class="p">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>examples</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="p">.</span><span class="nx">example</span><span class="p">(</span><span class="s">&#39;$0 -c compile -c test&#39;</span><span class="p">,</span> <span class="s">&#39;to rerun the tests after code changes&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">example</span><span class="p">(</span><span class="s">&#39;$0 -c publish --minor&#39;</span><span class="p">,</span>
  <span class="s">&#39;to do the complete publishing cycle&#39;</span><span class="p">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<p>commands</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="p">.</span><span class="nx">demand</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;command&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">array</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;command to execute (use list to see more)&#39;</span><span class="p">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>general options</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="p">.</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&#39;C&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="s">&#39;nocolors&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="s">&#39;turn of color output&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&#39;v&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&#39;v&#39;</span><span class="p">,</span> <span class="s">&#39;verbose&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&#39;v&#39;</span><span class="p">,</span> <span class="s">&#39;run in verbose mode&#39;</span><span class="p">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>create options</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&#39;private&#39;</span><span class="p">,</span> <span class="s">&#39;create: private repository&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&#39;package&#39;</span><span class="p">,</span> <span class="s">&#39;create: set package name&#39;</span><span class="p">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>push options</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="s">&#39;message&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="s">&#39;push: text for commit message&#39;</span><span class="p">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>compile options</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="s">&#39;uglify&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="s">&#39;compile: run uglify for each file&#39;</span><span class="p">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>publish options</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="p">.</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&#39;minor&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&#39;minor&#39;</span><span class="p">,</span> <span class="s">&#39;publish: change to next minor version&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&#39;major&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&#39;major&#39;</span><span class="p">,</span> <span class="s">&#39;publish: change to next major version&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&#39;try&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&#39;try&#39;</span><span class="p">,</span> <span class="s">&#39;publish: don\&#39;t really publish but check if it is possible&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&#39;force&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&#39;force&#39;</span><span class="p">,</span> <span class="s">&#39;publish: also if tests have errors or submodules not up-to-date&#39;</span><span class="p">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>test options</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="p">.</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&#39;coverage&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&#39;coverage&#39;</span><span class="p">,</span> <span class="s">&#39;test: create coverage report&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&#39;coveralls&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&#39;coveralls&#39;</span><span class="p">,</span> <span class="s">&#39;test: send coverage to coveralls&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&#39;watch&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&#39;watch&#39;</span><span class="p">,</span> <span class="s">&#39;test,doc: keep process running while watching for changes&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&#39;browser&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&#39;browser&#39;</span><span class="p">,</span> <span class="s">&#39;test,doc: open in browser&#39;</span><span class="p">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<p>doc options</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="p">.</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&#39;publish&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&#39;publish&#39;</span><span class="p">,</span> <span class="s">&#39;doc: push to github pages&#39;</span><span class="p">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>clean options</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="p">.</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&#39;dist&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&#39;dist&#39;</span><span class="p">,</span> <span class="s">&#39;clean: all which is not needed in production&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&#39;auto&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s">&#39;auto&#39;</span><span class="p">,</span> <span class="s">&#39;clean: all which is created automatically&#39;</span><span class="p">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>general help</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="p">.</span><span class="nx">help</span><span class="p">(</span><span class="s">&#39;h&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s">&#39;h&#39;</span><span class="p">,</span> <span class="s">&#39;help&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">showHelpOnFail</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="s">&quot;Specify --help for available options&quot;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">epilogue</span><span class="p">(</span><span class="s">&quot;For more information, look into the man page.&quot;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">check</span> <span class="nf">(argv, options) -&gt;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>optimize the arguments for processing</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">argv._ = </span><span class="p">[</span><span class="s">&#39;./&#39;</span><span class="p">]</span> <span class="k">unless</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">_</span><span class="p">.</span><span class="nx">length</span>
  <span class="nv">argv.command = </span><span class="p">[</span><span class="nx">argv</span><span class="p">.</span><span class="nx">command</span><span class="p">]</span> <span class="k">unless</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">command</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>additional checks</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">for</span> <span class="nx">command</span> <span class="k">in</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">command</span>
    <span class="k">unless</span> <span class="nx">command</span> <span class="k">in</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span> <span class="nx">commands</span>
      <span class="k">return</span> <span class="s">&quot;Unknown command: </span><span class="si">#{</span><span class="nx">argv</span><span class="p">.</span><span class="nx">command</span><span class="si">}</span><span class="s">&quot;</span>
  <span class="kc">true</span>
<span class="p">.</span><span class="nx">strict</span><span class="p">()</span>
<span class="p">.</span><span class="nx">argv</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<p>implement some global switches</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nv">chalk.enabled = </span><span class="kc">false</span> <span class="k">if</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">nocolors</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<p>add additional dependent commands</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nv">cmds = </span><span class="p">[]</span>
<span class="k">for</span> <span class="nx">command</span> <span class="k">in</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">command</span>
  <span class="k">switch</span> <span class="nx">command</span>
    <span class="k">when</span> <span class="s">&#39;publish&#39;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<p>backward order because of unshift</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">cmds</span><span class="p">.</span><span class="nx">unshift</span> <span class="s">&#39;test&#39;</span>
      <span class="nx">cmds</span><span class="p">.</span><span class="nx">unshift</span> <span class="s">&#39;compile&#39;</span>
      <span class="nv">argv.uglify = </span><span class="kc">true</span>
      <span class="nx">cmds</span><span class="p">.</span><span class="nx">unshift</span> <span class="s">&#39;update&#39;</span>
      <span class="nx">cmds</span><span class="p">.</span><span class="nx">unshift</span> <span class="s">&#39;clean&#39;</span>
      <span class="nv">argv.auto = </span><span class="kc">true</span>
      <span class="nx">cmds</span><span class="p">.</span><span class="nx">unshift</span> <span class="s">&#39;push&#39;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>and at last add the command itself and document publish</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">cmds</span><span class="p">.</span><span class="nx">push</span> <span class="nx">command</span>
      <span class="nx">cmds</span><span class="p">.</span><span class="nx">push</span> <span class="s">&#39;doc&#39;</span>
      <span class="nv">argv.publish = </span><span class="kc">true</span>
    <span class="k">else</span>
      <span class="nx">cmds</span><span class="p">.</span><span class="nx">push</span> <span class="nx">command</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="init%20config">
  <h2>
    <a href="#init%20config" name="init%20config" class="pilcrow">&#182;</a>
    Init config
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>




</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="run%20the%20commands">
  <h2>
    <a href="#run%20the%20commands" name="run%20the%20commands" class="pilcrow">&#182;</a>
    Run the commands
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">async</span><span class="p">.</span><span class="nx">each</span> <span class="nx">cmds</span><span class="p">,</span> <span class="nf">(command, cb) -&gt;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30">&#182;</a>
</div>
<p>load library because it may be away later</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">lib = </span><span class="nx">require</span> <span class="s">&quot;./tasks/</span><span class="si">#{</span><span class="nx">command</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">unless</span> <span class="nx">command</span> <span class="o">is</span> <span class="s">&#39;list&#39;</span>
  <span class="nx">cb</span><span class="p">()</span>
<span class="p">,</span> <span class="nf">(err) -&gt;</span>
  <span class="k">throw</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span>

  <span class="nx">async</span><span class="p">.</span><span class="nx">eachSeries</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">_</span><span class="p">,</span> <span class="nf">(dir, cb) -&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">chalk</span><span class="p">.</span><span class="nx">blue</span><span class="p">.</span><span class="nx">bold</span> <span class="s">&quot;Working on </span><span class="si">#{</span><span class="nx">dir</span><span class="si">}</span><span class="s">&quot;</span>
    <span class="nv">argv.done = </span><span class="p">[]</span>
    <span class="nx">async</span><span class="p">.</span><span class="nx">eachSeries</span> <span class="nx">cmds</span><span class="p">,</span> <span class="nf">(command, cb) -&gt;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31">&#182;</a>
</div>
<p>skip if command already done</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span> <span class="k">if</span> <span class="nx">command</span> <span class="k">in</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">done</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32">&#182;</a>
</div>
<p>list possible commands</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="nx">command</span> <span class="o">is</span> <span class="s">&#39;list&#39;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;\nThe following commands are possible:\n&quot;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;- </span><span class="si">#{</span><span class="nx">key</span><span class="si">}</span><span class="s"> - </span><span class="si">#{</span><span class="nx">title</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">title</span> <span class="k">of</span> <span class="nx">commands</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">chalk</span><span class="p">.</span><span class="nx">blue</span> <span class="nx">commands</span><span class="p">[</span><span class="nx">command</span><span class="p">]</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33">&#182;</a>
</div>
<p>check for try</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">try</span> <span class="o">and</span> <span class="nx">command</span> <span class="o">is</span> <span class="s">&#39;publish&#39;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">chalk</span><span class="p">.</span><span class="nx">yellow</span> <span class="s">&quot;Publishing is possible but won&#39;t be called because of --try flag.&quot;</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34">&#182;</a>
</div>
<p>load task library</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">lib = </span><span class="nx">require</span> <span class="s">&quot;./tasks/</span><span class="si">#{</span><span class="nx">command</span><span class="si">}</span><span class="s">&quot;</span>
      <span class="nx">lib</span><span class="p">.</span><span class="nx">run</span> <span class="nx">dir</span><span class="p">,</span> <span class="nx">argv</span><span class="p">,</span> <span class="nf">(err) -&gt;</span>
        <span class="nx">argv</span><span class="p">.</span><span class="nx">done</span><span class="p">.</span><span class="nx">push</span> <span class="nx">command</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35">&#182;</a>
</div>
<p>log done comamnds</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="nx">command</span> <span class="o">is</span> <span class="s">&#39;update&#39;</span>
          <span class="nx">argv</span><span class="p">.</span><span class="nx">done</span><span class="p">.</span><span class="nx">push</span> <span class="s">&#39;compile&#39;</span> <span class="c1"># this is called by npm</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36">&#182;</a>
</div>
<p>return error</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">cb</span> <span class="k">if</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">force</span> <span class="k">then</span> <span class="kc">null</span> <span class="k">else</span> <span class="nx">err</span>
    <span class="p">,</span> <span class="nf">(err) -&gt;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37">&#182;</a>
</div>
<p>protocol error on dir</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="nx">chalk</span><span class="p">.</span><span class="nx">bold</span> <span class="nx">chalk</span><span class="p">.</span><span class="nx">red</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38">&#182;</a>
</div>
<p>go on</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">cb</span><span class="p">()</span>
  <span class="p">,</span> <span class="nf">(err) -&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">chalk</span><span class="p">.</span><span class="nx">green</span> <span class="s">&quot;Done.&quot;</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
