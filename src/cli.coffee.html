<!DOCTYPE html>
<html>
<head>
  <title>cli.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../";
    var thisFile = "home/alex/github/node-builder/src/cli.coffee";
    var defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0" /></head>
<body>
  <nav>
<div class="logo"><a href="http://alinex.github.io"
  onmouseover="logo.src='https://alinex.github.io/images/Alinex-200.png'"
  onmouseout="logo.src='https://alinex.github.io/images/Alinex-black-200.png'">
  <img name="logo" src="https://alinex.github.io/images/Alinex-black-200.png"
    width="150" title="Alinex Universe Homepage" />
  </a>
  <img src="http://alinex.github.io/images/Alinex-200.png"
    style="display:none" alt="preloading" />
</div>
<div class="links">
  <a href="http://alinex.github.io/blog"
    class="btn btn-primary"><span class="glyphicon-pencil"></span> Blog</a>
  <a href="http://alinex.github.io/develop"
    class="btn btn-primary"><span class="glyphicon-book"></span> Develop</a>
  <a href="http://alinex.github.io/code.html"
    class="btn btn-warning"><span class="glyphicon-cog"></span> Code</a>
</div>
</nav><div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#startup-script">Startup script</a>
      </div>

      <div class="heading h3">
        <a href="#main-routine">Main routine</a>
      </div>

      <div class="heading h3">
        <a href="#task-libraries">Task libraries</a>
      </div>

      <div class="heading h2">
        <a href="#node-modules">Node Modules</a>
      </div>

      <div class="heading h2">
        <a href="#setup-build-environment">Setup build environment</a>
      </div>

      <div class="heading h2">
        <a href="#start-argument-parsing">Start argument parsing</a>
      </div>

      <div class="heading h2">
        <a href="#init-config">Init config</a>
      </div>

      <div class="heading h2">
        <a href="#run-the-commands">Run the commands</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container" tabindex="0"><a id="fork" href="https://github.com/alinex/node-builder" title="Fork me on GitHub"></a>
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="startup-script">
  <h1>
    <a href="#startup-script" name="startup-script" class="pilcrow"></a>
Startup script
  </h1>
</div>
<p>This file is used to manage the whole build environment.</p>
<div class="pilwrap" id="main-routine">
  <h3>
    <a href="#main-routine" name="main-routine" class="pilcrow"></a>
Main routine
  </h3>
</div>
<p>This file defines the command line interface with the defined commands. They
will be run in parallel as possible.</p>
<p>It will work with an boolean <code>success</code> value which is handed through the
functions to define if everything went correct or something was not possible.
If an real and unexpected error occur it will be thrown. All errors which
aren't caught will end in an error and abort with exit code 2.</p>
<div class="pilwrap" id="task-libraries">
  <h3>
    <a href="#task-libraries" name="task-libraries" class="pilcrow"></a>
Task libraries
  </h3>
</div>
<p>Each task is made available as separate task module with the <code>run</code> method
to be called for each alinex package. The given command on the command line
call may trigger multiple tasks which are done.</p>
<p>Each task will get a <code>command</code> object which holds all the information from the
command line call.</p>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="node-modules">
  <h2>
    <a href="#node-modules" name="node-modules" class="pilcrow"></a>
Node Modules
  </h2>
</div>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>include base modules</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">fs = <span class="hljs-built_in">require</span> <span class="hljs-string">'fs'</span>
yargs = <span class="hljs-built_in">require</span> <span class="hljs-string">'yargs'</span>
path = <span class="hljs-built_in">require</span> <span class="hljs-string">'path'</span>
chalk = <span class="hljs-built_in">require</span> <span class="hljs-string">'chalk'</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>include alinex modules</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">async = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-async'</span>
config = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-config'</span>
Exec = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-exec'</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="setup-build-environment">
  <h2>
    <a href="#setup-build-environment" name="setup-build-environment" class="pilcrow"></a>
Setup build environment
  </h2>
</div>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Root directory of the core application</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">GLOBAL.ROOT_DIR = path.dirname __dirname
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>Read in package configuration</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">GLOBAL.PKG = JSON.parse fs.readFileSync path.join GLOBAL.ROOT_DIR, <span class="hljs-string">'package.json'</span>

Exec.setup -&gt;
  config.register <span class="hljs-string">'builder'</span>, path.dirname(__dirname),
    <span class="hljs-attribute">uri</span>: <span class="hljs-string">'*'</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>list of possible commands</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">commands =
  <span class="hljs-attribute">list</span>: <span class="hljs-string">"show the list of possible commands"</span>
  <span class="hljs-attribute">create</span>: <span class="hljs-string">"create a new package"</span>
  <span class="hljs-attribute">update</span>: <span class="hljs-string">"update and installation of package with dependent packages"</span>
  <span class="hljs-attribute">compile</span>: <span class="hljs-string">"compile code"</span>
  <span class="hljs-attribute">link</span>: <span class="hljs-string">"link local modules instead of npm package"</span>
  <span class="hljs-attribute">pull</span>: <span class="hljs-string">"pull newest version from repository"</span>
  <span class="hljs-attribute">push</span>: <span class="hljs-string">"push changes to repository"</span>
  <span class="hljs-attribute">publish</span>: <span class="hljs-string">"publish package in npm"</span>
  <span class="hljs-attribute">doc</span>: <span class="hljs-string">"create documentation pages"</span>
  <span class="hljs-attribute">test</span>: <span class="hljs-string">"run automatic tests"</span>
  <span class="hljs-attribute">clean</span>: <span class="hljs-string">"cleanup files"</span>
  <span class="hljs-attribute">changes</span>: <span class="hljs-string">"list unpublished changes"</span>


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="start-argument-parsing">
  <h2>
    <a href="#start-argument-parsing" name="start-argument-parsing" class="pilcrow"></a>
Start argument parsing
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">argv = yargs
.usage(<span class="hljs-string">"""
  Utility to help simplify tasks in development.

  Usage: $0 [-vC] -c command... [dir]...
  """</span>)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>examples</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">.example(<span class="hljs-string">'$0 -c compile -c test'</span>, <span class="hljs-string">'to rerun the tests after code changes'</span>)
.example(<span class="hljs-string">'$0 -c publish --minor'</span>,
  <span class="hljs-string">'to do the complete publishing cycle'</span>)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>commands</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">.demand(<span class="hljs-string">'c'</span>)
.alias(<span class="hljs-string">'c'</span>, <span class="hljs-string">'command'</span>)
.array(<span class="hljs-string">'c'</span>)
.describe(<span class="hljs-string">'c'</span>, <span class="hljs-string">'command to execute (use list to see more)'</span>)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>general options</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">.boolean(<span class="hljs-string">'C'</span>)
.alias(<span class="hljs-string">'C'</span>, <span class="hljs-string">'nocolors'</span>)
.describe(<span class="hljs-string">'C'</span>, <span class="hljs-string">'turn of color output'</span>)
.boolean(<span class="hljs-string">'v'</span>)
.alias(<span class="hljs-string">'v'</span>, <span class="hljs-string">'verbose'</span>)
.describe(<span class="hljs-string">'v'</span>, <span class="hljs-string">'run in verbose mode'</span>)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>create options</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">.boolean(<span class="hljs-string">'private'</span>)
.describe(<span class="hljs-string">'private'</span>, <span class="hljs-string">'create: private repository'</span>)
.describe(<span class="hljs-string">'package'</span>, <span class="hljs-string">'create: set package name'</span>)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>link</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">.array(<span class="hljs-string">'local'</span>)
.describe(<span class="hljs-string">'local'</span>, <span class="hljs-string">'link: path or name of local package'</span>)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>test options</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">.boolean(<span class="hljs-string">'b'</span>)
.alias(<span class="hljs-string">'b'</span>, <span class="hljs-string">'bail'</span>)
.describe(<span class="hljs-string">'b'</span>, <span class="hljs-string">'stop after first error'</span>)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>push options</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">.alias(<span class="hljs-string">'m'</span>, <span class="hljs-string">'message'</span>)
.describe(<span class="hljs-string">'m'</span>, <span class="hljs-string">'push: text for commit message'</span>)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>compile options</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">.alias(<span class="hljs-string">'u'</span>, <span class="hljs-string">'uglify'</span>)
.describe(<span class="hljs-string">'u'</span>, <span class="hljs-string">'compile: run uglify for each file'</span>)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>publish options</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">.boolean(<span class="hljs-string">'minor'</span>)
.describe(<span class="hljs-string">'minor'</span>, <span class="hljs-string">'publish: change to next minor version'</span>)
.boolean(<span class="hljs-string">'major'</span>)
.describe(<span class="hljs-string">'major'</span>, <span class="hljs-string">'publish: change to next major version'</span>)
.boolean(<span class="hljs-string">'try'</span>)
.describe(<span class="hljs-string">'try'</span>, <span class="hljs-string">'publish: don\'t really publish but check if it is possible'</span>)
.boolean(<span class="hljs-string">'force'</span>)
.describe(<span class="hljs-string">'force'</span>, <span class="hljs-string">'publish: also if tests have errors or submodules not up-to-date'</span>)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>test options</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">.boolean(<span class="hljs-string">'coverage'</span>)
.describe(<span class="hljs-string">'coverage'</span>, <span class="hljs-string">'test: create coverage report'</span>)
.boolean(<span class="hljs-string">'coveralls'</span>)
.describe(<span class="hljs-string">'coveralls'</span>, <span class="hljs-string">'test: send coverage to coveralls'</span>)
.boolean(<span class="hljs-string">'watch'</span>)
.describe(<span class="hljs-string">'watch'</span>, <span class="hljs-string">'test,doc: keep process running while watching for changes'</span>)
.boolean(<span class="hljs-string">'browser'</span>)
.describe(<span class="hljs-string">'browser'</span>, <span class="hljs-string">'test,doc: open in browser'</span>)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>doc options</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">.boolean(<span class="hljs-string">'publish'</span>)
.describe(<span class="hljs-string">'publish'</span>, <span class="hljs-string">'doc: push to github pages'</span>)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>clean options</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">.boolean(<span class="hljs-string">'dist'</span>)
.describe(<span class="hljs-string">'dist'</span>, <span class="hljs-string">'clean: all which is not needed in production'</span>)
.boolean(<span class="hljs-string">'auto'</span>)
.describe(<span class="hljs-string">'auto'</span>, <span class="hljs-string">'clean: all which is created automatically'</span>)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>general help</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">.help(<span class="hljs-string">'h'</span>)
.alias(<span class="hljs-string">'h'</span>, <span class="hljs-string">'help'</span>)
.showHelpOnFail(<span class="hljs-literal">false</span>, <span class="hljs-string">"Specify --help for available options"</span>)
.epilogue(<span class="hljs-string">"For more information, look into the man page."</span>)
.check (argv) -&gt;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>optimize the arguments for processing</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  argv._ = [<span class="hljs-string">'./'</span>] <span class="hljs-keyword">unless</span> argv._.length
  argv.command = [argv.command] <span class="hljs-keyword">unless</span> Array.isArray argv.command
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>additional checks</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">for</span> command <span class="hljs-keyword">in</span> argv.command
    <span class="hljs-keyword">unless</span> command <span class="hljs-keyword">in</span> Object.keys commands
      <span class="hljs-keyword">return</span> <span class="hljs-string">"Unknown command: <span class="hljs-subst">#{argv.command}</span>"</span>
  <span class="hljs-literal">true</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>.strict()</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">.argv
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>implement some global switches</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">chalk.enabled = <span class="hljs-literal">false</span> <span class="hljs-keyword">if</span> argv.nocolors
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>add additional dependent commands</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">cmds = []
<span class="hljs-keyword">for</span> command <span class="hljs-keyword">in</span> argv.command
  <span class="hljs-keyword">switch</span> command
    <span class="hljs-keyword">when</span> <span class="hljs-string">'test'</span>
      cmds.push command
      argv.coverage = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">when</span> <span class="hljs-string">'publish'</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>backward order because of unshift</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      cmds.unshift <span class="hljs-string">'test'</span>
      argv.coverage = <span class="hljs-literal">true</span>
      cmds.unshift <span class="hljs-string">'compile'</span>
      argv.uglify = <span class="hljs-literal">true</span>
      cmds.unshift <span class="hljs-string">'update'</span>
      cmds.unshift <span class="hljs-string">'clean'</span>
      argv.auto = <span class="hljs-literal">true</span>
      cmds.unshift <span class="hljs-string">'push'</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>and at last add the command itself and document publish</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      cmds.push command
      cmds.push <span class="hljs-string">'doc'</span>
      argv.publish = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">else</span>
      cmds.push command


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="init-config">
  <h2>
    <a href="#init-config" name="init-config" class="pilcrow"></a>
Init config
  </h2>
</div>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="run-the-commands">
  <h2>
    <a href="#run-the-commands" name="run-the-commands" class="pilcrow"></a>
Run the commands
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">async.each cmds, <span class="hljs-function"><span class="hljs-params">(command, cb)</span> -&gt;</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>load library because it may be away later</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  lib = <span class="hljs-built_in">require</span> <span class="hljs-string">"./tasks/<span class="hljs-subst">#{command}</span>"</span> <span class="hljs-keyword">unless</span> command <span class="hljs-keyword">is</span> <span class="hljs-string">'list'</span>
  cb()
, <span class="hljs-function"><span class="hljs-params">(err)</span> -&gt;</span>
  <span class="hljs-keyword">throw</span> err <span class="hljs-keyword">if</span> err

  async.eachSeries argv._, <span class="hljs-function"><span class="hljs-params">(dir, cb)</span> -&gt;</span>
    <span class="hljs-built_in">console</span>.log chalk.blue.bold <span class="hljs-string">"Working on <span class="hljs-subst">#{dir}</span>"</span>
    argv.done = []
    async.eachSeries cmds, <span class="hljs-function"><span class="hljs-params">(command, cb)</span> -&gt;</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>skip if command already done</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      <span class="hljs-keyword">return</span> cb() <span class="hljs-keyword">if</span> command <span class="hljs-keyword">in</span> argv.done
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<p>list possible commands</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      <span class="hljs-keyword">if</span> command <span class="hljs-keyword">is</span> <span class="hljs-string">'list'</span>
        <span class="hljs-built_in">console</span>.log <span class="hljs-string">"\nThe following commands are possible:\n"</span>
        <span class="hljs-built_in">console</span>.log <span class="hljs-string">"- <span class="hljs-subst">#{key}</span> - <span class="hljs-subst">#{title}</span>"</span> <span class="hljs-keyword">for</span> key, title <span class="hljs-keyword">of</span> commands
        <span class="hljs-keyword">return</span> cb()
      <span class="hljs-built_in">console</span>.log chalk.blue commands[command]
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>check for try</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      <span class="hljs-keyword">if</span> argv.<span class="hljs-keyword">try</span> <span class="hljs-keyword">and</span> command <span class="hljs-keyword">is</span> <span class="hljs-string">'publish'</span>
        <span class="hljs-built_in">console</span>.log chalk.yellow <span class="hljs-string">"Publishing is possible but won't be called because of --try flag."</span>
        <span class="hljs-keyword">return</span> cb()
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<p>load task library</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      lib = <span class="hljs-built_in">require</span> <span class="hljs-string">"./tasks/<span class="hljs-subst">#{command}</span>"</span>
      lib.run dir, argv, <span class="hljs-function"><span class="hljs-params">(err)</span> -&gt;</span>
        argv.done.push command
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<p>log done comamnds</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">        <span class="hljs-keyword">if</span> command <span class="hljs-keyword">is</span> <span class="hljs-string">'update'</span>
          argv.done.push <span class="hljs-string">'compile'</span> <span class="hljs-comment"># this is called by npm</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>return error</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">        cb <span class="hljs-keyword">if</span> argv.force <span class="hljs-keyword">then</span> <span class="hljs-literal">null</span> <span class="hljs-keyword">else</span> err
    , <span class="hljs-function"><span class="hljs-params">(err)</span> -&gt;</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>protocol error on dir</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      <span class="hljs-built_in">console</span>.error chalk.bold chalk.red err <span class="hljs-keyword">if</span> err
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>go on</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      cb()
  , <span class="hljs-function">-&gt;</span>
    <span class="hljs-built_in">console</span>.log chalk.green <span class="hljs-string">"Done."</span>

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
